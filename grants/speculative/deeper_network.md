# Deeper Network

## Project Description

Deeper Network is committed to building a truly decentralized and secure gateway to a more democratic internet. It aims to bring a better internet experience to every household and become the de facto portal to Web 3.0.

There are two layers in the blockchain architecture. The top layer consists of hundreds of validator nodes (substrate node). The bottom layer, also called the deeper layer, consists of potentially millions of deeper devices. These devices earn credits by providing services in the deeper network, e.g., sharing bandwidth. A device can delegate its credits to validator node to participate in consensus and earn block reward. The consensus is a combination of Proof of Stake (PoS) and Proof of Credit (PoC). The two layers secure each other by the PoC component. The token economics increases the network by incentivizing more users to join the network.

## Team members

-   Hui Liu
-   Chao Ma
-   Zhuang Jin
-   Yi Cui
-   Yang Liu

## Team Website

[https://deepernetwork.io/](https://deepernetwork.io/)
[https://deeper.network/](https://deeper.network/)

## Team Code Repos

[e2-chain](https://github.com/e2chain-dev/e2-chain)

## Legal Structure

Deeper Network Inc in CA, USA

## Team's Experience

**Hui Liu**  
Hui worked at Intel, Fortinet, and Palo Alto Networks, where he held positions such as R&D Manager and Chief Engineer. He brings more than ten years of experience in network security and operating system development. He spearheaded the development of the cloud firewall engine which still brings billions of dollars in annual revenue for the company.

**Chao Ma**  
Chao has a Ph.D in mathematics and focuses on researching blockchain, cryptography, and zero knowledge proof. He was a protocol architect and core developer at Harmony, a public blockchain startup, where he led efforts into various components of the core protocol.

**Zhuang Jin**
Zhuang has a master’s degree in Electrical Engineering. He has working experience in network security, distributed system, and embedded system development.

**Yi Cui**  
Yi earned his PhD degree in Computer Science. He worked on Network Infrastructure at Google, where he focused on data center congestion control, network measurement, and traffic engineering.

**Yang Liu**
Yang worked at Bytedance, Alibaba, Windriver, and has working experience in cloud infrastructure, operating system and embedded system.

## Development Roadmap

### M1: Micropayments – 4 weeks

| Number | Deliverable    | Specification                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ------ | -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0a.    | License        | GPLv3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| 0b.    | Description    | For our testnet, we use one-way micropayment protocol. There are 2 parties: Sender and Receiver. There are 3 steps: Sender open a channel; sender sends accumulated micropayments to receiver; Receiver closes a channel or the channel closed after expiration. When sending the accumulated micropayments, the sender will sign the following data: (receiver, address, nonce, sessionId, accumulateAmount). Each time a new (sender, receiver) channel is opened, nonce is increased by 1 to avoid replay attack. sessionId represents one unique session inside one channel. When a channel is open/active, it can contains multiple sessions. The receiver can only claim once for each unique (nonce,sessionId) pair. |
| 0c.    | Testing Guide  | The tests will verify the basic functionalities like opening channels, sending micropayments, claiming payments, and closing channels. 1. Opening channels: verify that sender has enough balance to reserve and the channels are unique; 2. Sending micropayments: verify that receiver info and payment amount is correct, the payment is indeed signed by sender, and sender has enough reserved balance. Verify that micropayments are received in each service period; 3. Claiming payments: Verify that balance transfer is submitted on chain; 4. Closing channels: only receiver can close the channel. Clear any outstanding micropayment balances and free reserved balance of sender.                            |
| 1.     | Channel open   | sender who opens the channel should reserve enough funds for accumulated micropayments. Channel data structure contains sender, receiver, nonce (to avoid replay attack), expiration time.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2.     | Channel close  | channel will be closed after expiration time passed. Only the receiver can close the channel before the expiration time. The remaining amount which is not claimed by the receiver will be refunded to sender during close.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| 3.     | Claim payments | During the lifetime of the channel, the receiver can claim accumulated micropayments. The sessionId becomes invalid after claim, and the sender should start using a different sessionId for a different micropayment session.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 4.     | Client         | The client inside a deeper device (light node) can use APIs to interact with other clients: open channel, close channel, claim payment.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |

### M2: Light Node - 4 weeks

| Number | Deliverable                | Specification                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------ | -------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 0a.    | License                    | GPLv3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 0b.    | Description                | This pallet is responsible for deeper node (in deeper layer) registration and node discovery. In testnet, the IP address will be encrypted and put on chain. In future, we will avoid to store encrypted IP on chain and peer discovery happens only on deeper layer.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 0c.    | Testing Guide              | 1. register_device: If the arguments as the encrypted IP address and country code of the device are valid, the sender is required to make a deposit of MIN_LOCK_AMT for the device registration and device is registered. 2. unregister_device: We first make sure the sender has registered a device before. The deposit for device registration is returned to the sender and the device is removed from the registration list. If the device has been registered as a server, it's removed from the server list. 3. register_server: The device must be added in the registration list through register_device before it can be registered as a server. Double server registration is not allowed. The device is added to the server list specific for the corresponding country. 4. unregister_server: The device must be added in the registration list through register_device and be added in the server list through register_server before it can be removed from the server list. The device should still be in the registration list even if it's removed from the server list. |
| 1.     | register/unregister device | An account needs to register to become a valid deeper device. Only a valid deeper device can earn credits. To register, a fixed amount of tokens will be reserved. The tokens will be returned to the user when unregistering the device.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| 2.     | register/unregister server | A registered device can register itself as a server. A server will provide network service to earn micropayments and credit scores. When a device is registered as a server, it needs to provide its region code and its encrypted IP.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| 3.     | client                     | The client side is responsible for IP encryption before registration. A client will randomly select peer nodes, obtain the encrypted peer IP address and decrypt it to get the actual IP address.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          |

### M3: Proof of Credit - 6 weeks

| Number | Deliverable                   | Specification                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| ------ | ----------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 0a.    | License                       | GPLv3                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| 0b.    | Description                   | Proof of Credit is a key component in deeper network. It consists of 4 parts: Credit scores update; credit scores delegation; validator weight modification in consensus and reward distribution modification. For detail description of PoC, please refer to the whitepaper.                                                                                                                                                                                                                                                                                                                                                                                                                              |
| 0c.    | Testing Guide                 | There are many test cases for PoC component. Here we list a few important ones. 1. Credit score udpate: initialize credit score the second time will fail. credit score is capped when reach maximum value. credit score drops down slowly after a few sessions but has lower bound. 2. Credit score delegation: delegation of credit score will show up in validator's account. cannot redelegate to a different validator. delegator can withdraw credit score but the credit score will be locked until next session. The weight of a delegator's credit score is refresh at the beginning of each session. If a delegator's credit score is below threshold, it will be removed from validator's list. |
| 1.     | credit score update           | Initialize and kill credit of an account; Update credit according to accumulated micropayments                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| 2.     | credit score delegation       | delegation of credit scores from light nodes to validator accounts. validator is responsible for threshold checking: An account can delegate its credit score to validator only if it’s credit score is above some threshold value.                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| 3.     | consensus weight modification | Modify validator’s voting power from PoS to combination of PoS and PoC: currently, the weights of PoS and PoC are equal.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| 4.     | reward modification           | Modify the distribution of block reward to both staking delegation and credit delegation accounts: the block reward is distributed evenly between PoS and PoC participants.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |

### Future Work

1. Add distributed random number generation for the pairing of light nodes. It will be based on BABE’s random seed.
2. Do not store the encrypted IP addresses in the light node pallet. Instead, the p2p layer is responsible to discover the IP address from the public key. Kademlia routing is a good candidate.
3. Adjust the parameters of the credit update formula based on experiments after the launch of testnet.
4. Adjust the weights of PoS and PoC based on experiments after the launch of testnet.
5. Add more functions to Proof of Credit and delegation pallets: credit slashing for malicious behaviors; credit diminishing for long time inactive devices.

## Additional Information

### What work has been done so far?

1. Code is open source at https://github.com/e2chain-dev/e2-chain
2. MVP is developed for core features: micropayments(master branch), light node(master branch), proof of credit(poc branch).

### Have you applied for other grants so far?

We have applied for Substrate Builder's program and got accepted.

### How is your project different?

1. **From products to blockchain ecosystem**
   Deeper Network has developed world's first lock-free network OS (AtomOS). Its flagship product Deeper Connect provides fast and secure decentralized private network (DPN) service, together with its plug-and-play design, it becomes one of the most popular projects in indiegogo compaign (https://igg.me/at/dcmini). There are already 5000+ of active devices across the world, they become a solid foundation for a decentralized and healthy blockchain ecosystem. With the low cost of deeper devices, with the mature product distribution channel and the token economics of blockchain, the network expects to grow exponentially. These devices will become the gateway for massive normal users into the blockchain world and polka ecosystem.

1. **Proof of Credit**
   Proof of Credit (PoC) is a unique consensus mechanism introduced by Deeper Network. When users share their bandwidth, in addition to earning micropayments, users will also earn credits akin to the credit system in the real world. The design of PoC ensures the credit score update is secure against Sibil attack. An account can delegate its credit store to validator similar to PoS staking mechanism, and the account will be rewarded proportional to its credit score weight.

1. **Decentralized credit system**
   With the introduction of decentralized credit system, deeper network is essentially a financial system. The credit scores play several major roles: it secures the network through PoC consensus; it incentivizes users to contribute more to the p2p Deeper layer; it is used to govern the protocol; it can be used to develop a lot of applications pertaining to users’ credit scores similar to our real-world credit system.
